<script setup lang="ts">
const { x: mouseX, y: mouseY } = useMouse();
const { height, width } = useWindowSize();

const eye = ref<HTMLElement | null>(null);
const eyeLocation = ref<DOMRect | null>(null);
const eX = ref(0);
const eY = ref(0);

const rotationDeg = ref(0);

function getEyeLocation() {
  eyeLocation.value = eye?.value?.getBoundingClientRect() ?? null;
}
function angle(cx: number, cy: number, ex: number, ey: number) {
  const dx = ex - cx;
  const dy = ey - cy;
  const rad = Math.atan2(dy, dx);
  const deg = rad * 180 / Math.PI;
  return deg;
}

onMounted(() => {
  getEyeLocation();
});

debouncedWatch([width, height], () => {
  getEyeLocation();
}, { debounce: 150 });

throttledWatch([mouseX, mouseY], ([x, y]) => {
  if (eyeLocation.value) {
    eX.value = eyeLocation.value.left + eyeLocation.value?.width / 2;
    eY.value = eyeLocation.value.top + eyeLocation.value?.height / 2;
  }
  rotationDeg.value = angle(x, y, eX.value, eY.value);
}, { throttle: 1000 / 120 });
</script>

<template>
  <div class="eyes">
    <svg
      ref="eye"
      class="w-3rem h-3rem fill-stone-400"
      :style="`transform: rotate(${rotationDeg + 50}deg) translateZ(0)`"
      xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 100 100" xml:space="preserve"
    ><path d="M49.998,91.439c-21.802,0-39.54-17.74-39.54-39.545c0-21.803,17.738-39.542,39.54-39.542  c21.804,0,39.543,17.738,39.543,39.542C89.541,73.699,71.802,91.439,49.998,91.439z M49.998,15.353  c-20.148,0-36.54,16.393-36.54,36.542c0,20.15,16.392,36.545,36.54,36.545c20.149,0,36.543-16.395,36.543-36.545  C86.541,31.746,70.147,15.353,49.998,15.353z" /><path d="M67.168,57.356c-0.075-0.963-0.19-1.912-0.377-2.84c-0.142-0.713-0.325-1.411-0.53-2.1  c-0.203-0.686-0.442-1.354-0.705-2.012c-0.219-0.55-0.464-1.084-0.722-1.613c-0.268-0.551-0.554-1.09-0.862-1.616  c-0.269-0.457-0.532-0.917-0.828-1.353c-0.308-0.453-0.646-0.883-0.983-1.313c-0.296-0.379-0.605-0.745-0.924-1.105  c-0.344-0.388-0.684-0.779-1.051-1.144c-0.319-0.318-0.664-0.611-1.002-0.911c-0.367-0.326-0.741-0.644-1.128-0.947  c-0.344-0.27-0.692-0.535-1.053-0.786c-0.389-0.273-0.791-0.523-1.197-0.771c-0.366-0.224-0.723-0.461-1.101-0.666  c-0.41-0.223-0.839-0.411-1.263-0.609c-0.383-0.179-0.764-0.358-1.157-0.517c-0.432-0.174-0.87-0.332-1.313-0.482  c-0.401-0.135-0.807-0.257-1.219-0.372c-0.451-0.126-0.902-0.252-1.364-0.351c-0.42-0.091-0.848-0.152-1.275-0.221  c-0.474-0.075-0.941-0.162-1.423-0.209c-0.44-0.043-0.89-0.049-1.338-0.067c-0.34-0.015-0.676-0.052-1.02-0.052  c-0.16,0-0.313,0.021-0.474,0.023c-0.468,0.01-0.931,0.035-1.392,0.071c-0.531,0.042-1.055,0.106-1.576,0.182  c-0.488,0.071-0.98,0.132-1.457,0.231c-0.57,0.119-1.123,0.274-1.678,0.433c-0.531,0.152-1.052,0.329-1.568,0.517  c-0.609,0.222-1.209,0.463-1.795,0.732c-0.578,0.266-1.15,0.544-1.705,0.854c-0.689,0.387-1.357,0.808-2.005,1.258  c-0.688,0.48-1.345,1-1.979,1.549c-0.893,0.773-1.729,1.609-2.499,2.505c-3.375,3.923-5.487,8.946-5.744,14.452  c-0.017,0.375-0.057,0.744-0.057,1.123c0,0.838,0.046,1.666,0.13,2.48c0.086,0.834,0.22,1.65,0.389,2.455  c0.162,0.775,0.363,1.533,0.599,2.281c0.193,0.607,0.417,1.199,0.655,1.785c0.244,0.598,0.521,1.178,0.809,1.75  c0.248,0.49,0.514,0.965,0.793,1.438c0.295,0.496,0.598,0.984,0.926,1.455c0.283,0.408,0.584,0.805,0.891,1.193  c0.328,0.414,0.676,0.809,1.029,1.197c0.314,0.348,0.625,0.695,0.957,1.023c0.355,0.348,0.729,0.678,1.105,1.004  c0.336,0.291,0.68,0.568,1.031,0.842c0.381,0.297,0.76,0.594,1.159,0.867c0.354,0.242,0.728,0.455,1.095,0.678  c0.402,0.244,0.803,0.49,1.223,0.711c0.373,0.197,0.76,0.375,1.145,0.553c0.422,0.195,0.851,0.379,1.285,0.551  c0.395,0.154,0.789,0.303,1.191,0.436c0.442,0.148,0.896,0.271,1.348,0.395c0.413,0.109,0.819,0.23,1.238,0.318  c0.465,0.098,0.94,0.158,1.414,0.229c0.43,0.063,0.857,0.133,1.295,0.176c0.486,0.045,0.98,0.059,1.475,0.074  c0.25,0.01,0.495,0.039,0.748,0.039c0.207,0,0.407-0.027,0.612-0.033c0.516-0.014,1.028-0.031,1.536-0.076  c0.486-0.043,0.963-0.119,1.44-0.191c0.545-0.082,1.088-0.168,1.621-0.289c0.511-0.113,1.019-0.244,1.519-0.393  c0.593-0.172,1.17-0.379,1.742-0.596c0.557-0.215,1.104-0.443,1.64-0.695c0.649-0.303,1.283-0.633,1.899-0.992  c0.631-0.369,1.243-0.762,1.836-1.184c0.776-0.553,1.514-1.156,2.219-1.797c0.816-0.744,1.599-1.529,2.308-2.377  c3.161-3.787,5.151-8.566,5.48-13.793c0.032-0.502,0.077-1.002,0.077-1.514C67.263,58.597,67.217,57.976,67.168,57.356z   M52.582,39.739c0.424,0.201,0.844,0.403,1.253,0.631l-3.351,8.433c0.469-0.194,0.979-0.301,1.506-0.356l2.943-7.407  c0.404,0.259,0.795,0.533,1.181,0.817l-2.634,6.626c0.426,0.074,0.837,0.187,1.224,0.354l2.456-6.182  c0.383,0.319,0.746,0.66,1.106,1.004l-2.355,5.925c0.364,0.29,0.691,0.619,0.969,0.992l2.353-5.917  c0.355,0.388,0.702,0.783,1.03,1.196l-2.544,6.399c0.15,0.496,0.254,1.012,0.254,1.556c0,2.011-1.105,3.743-2.73,4.679l-0.43,1.082  c0.003-0.115,0.017-0.227,0.017-0.342c0-0.168-0.023-0.332-0.031-0.498c-0.686,0.313-1.44,0.498-2.243,0.498  c-2.995,0-5.421-2.426-5.421-5.419c0-1.788,0.876-3.362,2.213-4.35c-0.168-0.105-0.326-0.226-0.502-0.321L52.582,39.739z   M50.111,38.735c0.445,0.147,0.883,0.307,1.314,0.482l-3.728,9.378c-0.43-0.176-0.875-0.32-1.329-0.444L50.111,38.735z   M47.517,38.044c0.465,0.092,0.916,0.215,1.371,0.335l-3.777,9.504c-0.476-0.073-0.958-0.121-1.451-0.134L47.517,38.044z   M44.783,37.703c0.487,0.033,0.969,0.08,1.447,0.144l-3.948,9.939c-0.551,0.05-1.088,0.145-1.613,0.27L44.783,37.703z   M41.915,37.702c0.471-0.031,0.939-0.072,1.418-0.072c0.038,0,0.076,0.006,0.112,0.006L39.11,48.544  c-0.66,0.262-1.291,0.583-1.885,0.958L41.915,37.702z M25.103,47.697l-2.975,7.483C22.646,52.472,23.673,49.948,25.103,47.697z   M21.753,59.563l6.106-15.372c0.723-0.742,1.501-1.424,2.322-2.058l-8.149,20.511C21.871,61.638,21.769,60.61,21.753,59.563z   M23.188,66.956c-0.262-0.678-0.486-1.371-0.678-2.078l9.551-24.039c0.621-0.382,1.264-0.732,1.923-1.051L23.188,66.956z   M23.901,68.593l11.729-29.519c0.57-0.218,1.147-0.418,1.739-0.588l-12.604,31.72C24.454,69.683,24.167,69.146,23.901,68.593z   M25.603,71.53l13.289-33.436c0.525-0.111,1.064-0.186,1.605-0.256l-5.258,13.231c-2.1,2.082-3.4,4.969-3.4,8.16  c0,0.119,0.014,0.234,0.018,0.354l-5.27,13.262C26.241,72.419,25.917,71.981,25.603,71.53z M28.604,74.981  c-0.371-0.348-0.729-0.707-1.075-1.08l4.688-11.793c0.179,0.689,0.417,1.354,0.714,1.986L28.604,74.981z M30.767,76.761  c-0.391-0.281-0.787-0.563-1.159-0.869l4.118-10.361c0.299,0.455,0.633,0.883,0.992,1.291L30.767,76.761z M33.056,78.22  c-0.417-0.225-0.813-0.482-1.213-0.734l3.85-9.686c0.363,0.324,0.741,0.633,1.143,0.908L33.056,78.22z M35.484,79.329  c-0.436-0.172-0.862-0.357-1.284-0.555l3.735-9.398c0.409,0.219,0.837,0.406,1.276,0.574L35.484,79.329z M38.03,80.142  c-0.455-0.115-0.91-0.23-1.355-0.375l3.746-9.428c0.456,0.119,0.922,0.213,1.396,0.277L38.03,80.142z M40.698,80.651  c-0.479-0.061-0.951-0.131-1.42-0.219l3.861-9.719c0.066,0.004,0.13,0.012,0.194,0.012c0.454,0,0.9-0.033,1.341-0.084L40.698,80.651  z M43.5,80.819c-0.057,0-0.111,0.01-0.167,0.01c-0.443,0-0.879-0.041-1.315-0.068l4.132-10.396c0.597-0.15,1.179-0.338,1.735-0.578  L43.5,80.819z M46.465,80.573c-0.52,0.078-1.042,0.137-1.574,0.176l4.73-11.902c0.852-0.559,1.619-1.229,2.294-1.986L46.465,80.573z   M49.605,79.894c-0.549,0.166-1.109,0.307-1.676,0.43l13.223-33.277c0.329,0.478,0.628,0.976,0.917,1.48L49.605,79.894z   M53.026,78.503c-0.595,0.303-1.204,0.576-1.83,0.82l11.645-29.305c0.286,0.602,0.542,1.217,0.771,1.848L53.026,78.503z   M56.878,76.028c-0.664,0.537-1.367,1.025-2.093,1.479l9.427-23.719c0.215,0.826,0.384,1.668,0.501,2.526L56.878,76.028z   M64.486,63.497l-2.843,7.154c-0.755,1.199-1.625,2.318-2.593,3.348l5.88-14.799c0,0.01,0.002,0.02,0.002,0.029  C64.933,60.692,64.771,62.116,64.486,63.497z" /></svg>
  </div>
</template>
